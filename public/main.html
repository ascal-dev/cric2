<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FanCode Live Matches</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #0d0d0d; color: #e0e0e0; }
        .container { display: flex; min-height: 100vh; }
        .sidebar { width: 120px; background: #1c1c1c; padding: 20px; border-right: 2px solid #ff4500; overflow-y: auto; margin-top: 20px; }
        .sidebar h3 { margin-bottom: 15px; color: #ff4500; text-align: center; }
        .category-list, .tournament-filters { list-style: none; }
        .category-list li, .tournament-filters button { padding: 12px; cursor: pointer; border-bottom: 1px solid #333; transition: background 0.3s; display: block; width: 100%; text-align: left; background: none; border: none; color: #e0e0e0; }
        .category-list li:hover, .tournament-filters button:hover { background: #333; }
        .category-list li.active, .tournament-filters button.active { background: #ff4500; color: #000; font-weight: bold; }
        .main { flex: 1; padding: 20px; overflow-y: auto; }
        .tabs { display: flex; background: #1c1c1c; border-bottom: 2px solid #ff4500; margin-bottom: 20px; }
        .tab { padding: 15px 25px; cursor: pointer; border-right: 1px solid #333; transition: background 0.3s; font-weight: bold; }
        .tab:hover { background: #333; }
        .tab.active { background: #ff4500; color: #000; }
        .tab-content { display: none; animation: fadeIn 0.3s; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-top: 20px; }
        .card { background: #1c1c1c; border: 2px solid #ff4500; border-radius: 12px; overflow: hidden; transition: transform 0.3s; position: relative;height: auto; width: 250px; font-size: 0em;  }
        .card:hover { transform: translateY(-5px); }
         .card img { width: 100%; height: 188px; object-fit:cover; background: #fff; display: block; margin: 0px; padding: 0px; }


        .card-content { padding: 10px;}
        .status-badge { position: absolute; top: 10px; right: 10px; background: #ff0000; color: white; padding: 5px 10px; border-radius: 20px; font-size: 12px; font-weight: bold; }
        .match-name { font-size: 18px; font-weight: bold; margin-bottom: 5px; color: #ff4500; }
        .tournament { font-size: 14px; color: #ccc; margin-bottom: 5px; }
        .start-time { color: #28a745; font-weight: bold; margin-bottom: 5px; font-size: 14px; }
        .language { color: #007bff; margin-bottom: 5px; font-size: 14px; }
        .streaming-status { color: #6c757d; font-size: 12px; margin-bottom: 10px; }
        .stream-links { display: flex; flex-wrap: wrap; gap: 5px; margin-top: 10px; }
        .stream-links button { padding: 5px; border: none; border-radius: 6px; cursor: pointer; font-size: 7px; transition: background 0.3s; color: white; }
        .stream-links button.adfree_stream { background: #ff4500; }
        .stream-links button.dai_stream { background: #007bff; }
        .stream-links button.Primary_Playback_URL { background: #28a745; }
        .stream-links button.fancode_cdn { background: #6c757d; }
        .stream-links button.dai_google_cdn { background: #dc3545; }
        .stream-links button.cloudfront_cdn { background: #ffc107; }
        .stream-links button.sony_cdn { background: #17a2b8; }
        .stream-links button.hindi_stream { background: #6c25be; }
        .stream-links button:hover { opacity: 0.8; }
        .no-matches { text-align: center; color: #666; margin: 40px 0; font-style: italic; }
        #errorLog { color: #ff0000; text-align: center; margin: 10px 0; font-weight: bold; padding: 10px; border-radius: 6px; }
        .last-updated { text-align: center; display: block; margin: 10px 0; color: #ccc; font-size: 12px; }
        .loading { text-align: center; margin: 20px; color: #ff4500; }
        /* =================== 1024px =================== */
@media (max-width: 1024px) {
    .grid {
        grid-template-columns: repeat(4, 1fr);
    }
    .sidebar {
        width: 100px;
        padding: 15px;
        font-size: 15px;
    }
    .tab {
        font-size: 15px;
    }
}

/* =================== 900px =================== */
@media (max-width: 900px) {
    .grid {
        grid-template-columns: repeat(3, 1fr);
    }
    .sidebar {
        width: 80px;
        padding: 10px;
        font-size: 12px;
    }
    .tab {
        font-size: 14px;
    }
    .match-name {
        font-size: 16px;
    }
    .tournament,
    .start-time,
    .language {
        font-size: 13px;
    }
}

/* =================== 600px =================== */
@media (max-width: 850px) {
    .grid {
        grid-template-columns: repeat(2, 1fr);
    }
    .sidebar {
        width: 60px;
        padding: 6px;
        font-size: 10px;
    }
    .tab {
        font-size: 12px;
    }
    .match-name {
        font-size: 14px;
    }
    .tournament,
    .start-time,
    .language {
        font-size: 12px;
    }
}

/* =================== 500px =================== */
@media (max-width: 550px) {
    .grid {
        grid-template-columns: 1fr;
    }
    .tabs {
        flex-direction: column;
        font-size: 11px;
    }
    .tab {
        font-size: 10px;
    }
    .sidebar {
        font-size: 9px;
    }
    .match-name {
        font-size: 12px;
    }
    .tournament,
    .start-time,
    .language {
        font-size: 11px;
    }
}

/* =================== 400px =================== */
@media (max-width: 400px) {
    .sidebar {
        font-size: 7px;
        padding: 5px;
    }
    .tab {
       font-size: 8px;
    }
    .match-name {
        font-size: 10px;
    }
    .tournament,
    .start-time,
    .language {
        font-size: 9px;
    }
}

/* =================== 300px =================== */
@media (max-width: 300px) {
    .sidebar {
        font-size: 5px;
    }
    .tabs {
        font-size: 7px;
    }
    .match-name {
        font-size: 9px;
    }
    .tournament,
    .start-time,
    .language {
        font-size: 8px;
    }
}

/* =================== 200px =================== */
@media (max-width: 200px) {
    .sidebar {
        display: none;
    }
    .tabs {
        font-size: 6px;
    }
    .match-name {
        font-size: 8px;
    }
    .tournament,
    .start-time,
    .language {
        font-size: 7px;
    }
}


    </style>

<body>
  <div class="container">
    <div class="categories">
      <h2>Categories</h2>
      <select id="categoryFilter">
        <option value="">All Categories</option>
      </select>
    </div>

    <div class="stats">
      <p>Live (<span id="liveCount">0</span>)</p>
      <p>Upcoming (<span id="upcomingCount">0</span>)</p>
      <p>Completed (<span id="completedCount">0</span>)</p>
      <p>Total (<span id="totalCount">0</span>)</p>
    </div>

    <div class="matches" id="liveMatches">
      <h3>Live Matches</h3>
    </div>
    <div class="matches" id="upcomingMatches">
      <h3>Upcoming Matches</h3>
    </div>
    <div class="matches" id="completedMatches">
      <h3>Completed Matches</h3>
    </div>

    <div id="streamModal" class="modal">
      <div class="modal-content">
        <h2>All Streams</h2>
        <ul id="streamList"></ul>
        <button onclick="document.getElementById('streamModal').style.display='none'">Close</button>
      </div>
    </div>
  </div>

  <script>
    const API_URL = 'https://raw.githubusercontent.com/jitendra-unatti/fancode/main/data/fancode.json';

    async function loadMatches() {
      try {
        // Fetch fresh data on every load
        const response = await fetch(API_URL, { cache: 'no-store' });
        if (!response.ok) throw new Error('Failed to fetch data');
        const data = await response.json();

        // Process matches
        const processedMatches = (data.matches || []).map(match => ({
          ...match,
          teams: match.teams || [],
          streams: {
            adfree_stream: match.adfree_stream,
            dai_stream: match.dai_stream,
            Primary_Playback_URL: match.STREAMING_CDN?.Primary_Playback_URL,
            fancode_cdn: match.STREAMING_CDN?.fancode_cdn,
            dai_google_cdn: match.STREAMING_CDN?.dai_google_cdn,
            cloudfront_cdn: match.STREAMING_CDN?.cloudfront_cdn,
            sony_cdn: match.STREAMING_CDN?.sony_cdn,
            hindi_stream: match.STREAMING_CDN?.hindi_stream,
          }
        }));

        // Categorize matches
        const liveMatches = processedMatches.filter(m => m.status === 'LIVE');
        const upcomingMatches = processedMatches.filter(m => m.status === 'NOT_STARTED');
        const completedMatches = processedMatches.filter(m => m.status !== 'LIVE' && m.status !== 'NOT_STARTED');
        const categories = [...new Set(processedMatches.map(m => m.category))];

        // Update stats
        document.getElementById('liveCount').textContent = liveMatches.length;
        document.getElementById('upcomingCount').textContent = upcomingMatches.length;
        document.getElementById('completedCount').textContent = completedMatches.length;
        document.getElementById('totalCount').textContent = processedMatches.length;

        // Update category filter
        const categoryFilter = document.getElementById('categoryFilter');
        categories.forEach(category => {
          const option = document.createElement('option');
          option.value = category;
          option.textContent = category;
          categoryFilter.appendChild(option);
        });

        // Display matches
        function displayMatches(matches, containerId) {
          const container = document.getElementById(containerId);
          container.innerHTML = `<h3>${containerId.replace('Matches', ' Matches')}</h3>`;
          matches.forEach(match => {
            const div = document.createElement('div');
            div.className = 'match-card';
            div.innerHTML = `
              <h4>${match.title || 'Match'}</h4>
              <p>Teams: ${match.teams.join(' vs ') || 'Unknown'}</p>
              <p>Status: ${match.status || 'Unknown'}</p>
              <p>Category: ${match.category || 'Unknown'}</p>
              <button onclick="showStreams('${match.match_id}', ${JSON.stringify(match.streams)})">View Streams</button>
            `;
            container.appendChild(div);
          });
        }

        displayMatches(liveMatches, 'liveMatches');
        displayMatches(upcomingMatches, 'upcomingMatches');
        displayMatches(completedMatches, 'completedMatches');

        // Filter by category
        categoryFilter.addEventListener('change', () => {
          const selectedCategory = categoryFilter.value;
          const filteredMatches = selectedCategory
            ? processedMatches.filter(m => m.category === selectedCategory)
            : processedMatches;
          const filteredLive = filteredMatches.filter(m => m.status === 'LIVE');
          const filteredUpcoming = filteredMatches.filter(m => m.status === 'NOT_STARTED');
          const filteredCompleted = filteredMatches.filter(m => m.status !== 'LIVE' && m.status !== 'NOT_STARTED');
          displayMatches(filteredLive, 'liveMatches');
          displayMatches(filteredUpcoming, 'upcomingMatches');
          displayMatches(filteredCompleted, 'completedMatches');
        });
      } catch (err) {
        console.error('Fetch error:', err);
        alert('Failed to load matches: ' + err.message);
      }
    }

    function showStreams(matchId, streams) {
      const streamList = document.getElementById('streamList');
      streamList.innerHTML = '';
      Object.entries(streams).forEach(([key, url]) => {
        if (url) {
          const li = document.createElement('li');
          li.innerHTML = `<a href="/player.html?matchId=${matchId}&cdn=${key}" target="_blank">${key}</a>`;
          streamList.appendChild(li);
        }
      });
      document.getElementById('streamModal').style.display = 'block';
    }

    // Load matches on page load
    window.onload = loadMatches;
  </script>
</body>
</html>
