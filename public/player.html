<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cricket Stream</title>
  <style>
    body { margin: 0; padding: 20px; font-family: Arial, sans-serif; }
    video { width: 100%; max-width: 800px; }
    #error { color: red; }
  </style>
</head>
<body>
  <video controls autoplay>
    <source id="videoSource" src="" type="application/x-mpegURL">
    Your browser does not support the video tag.
  </video>
  <p id="error"></p>

  <script>
    async function loadStream() {
      const params = new URLSearchParams(window.location.search);
      const matchId = params.get('matchId');
      const cdn = params.get('cdn') || 'adfree_stream';

      if (!matchId || !cdn) {
        document.getElementById('error').textContent = 'Missing matchId or cdn parameter';
        return;
      }

      try {
        const response = await fetch('https://raw.githubusercontent.com/jitendra-unatti/fancode/main/data/fancode.json', { cache: 'no-store' });
        if (!response.ok) throw new Error('Failed to fetch data');
        const data = await response.json();

        const match = data.matches.find(m => m.match_id == matchId);
        if (!match) {
          document.getElementById('error').textContent = 'Match not found';
          return;
        }

        const streams = {
          adfree_stream: match.adfree_stream,
          dai_stream: match.dai_stream,
          Primary_Playback_URL: match.STREAMING_CDN?.Primary_Playback_URL,
          fancode_cdn: match.STREAMING_CDN?.fancode_cdn,
          dai_google_cdn: match.STREAMING_CDN?.dai_google_cdn,
          cloudfront_cdn: match.STREAMING_CDN?.cloudfront_cdn,
          sony_cdn: match.STREAMING_CDN?.sony_cdn,
          hindi_stream: match.STREAMING_CDN?.hindi_stream,
        };

        const streamUrl = streams[cdn];
        if (!streamUrl || !streamUrl.includes('.m3u8')) {
          document.getElementById('error').textContent = 'Invalid or missing stream URL';
          return;
        }

        const video = document.getElementById('videoSource');
        video.src = streamUrl;
        video.parentElement.load();
      } catch (err) {
        document.getElementById('error').textContent = 'Error loading stream: ' + err.message;
      }
    }

    window.onload = loadStream;
  </script>
</body>
</html>
